<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat√°logo de cursos</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/parametros.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body { background: #eef3f7; }

    .materia-item { transition: 0.3s ease; }
    .materia-item.fade-out { opacity: 0; transform: translateX(20px); }

    .search-box { max-width: 400px; margin: 0 auto 25px; }

    /* Resaltado */
    mark { background: yellow; padding: 0 4px; }

    /* M√≥viles */
    @media screen and (max-width: 767px) {
      .card-body .row { display: block; }
      .col-md-6, .col-lg-4 { width: 100% !important; }
    }
  </style>
</head>

<body>
  <div class="container-fluid min-vh-100 px-3 py-3">

    <h2 class="text-center mb-4 mt-2" style="color: #1a6;">Cat√°logo de Cursos Registrados</h2>

    <!-- üîç BUSCADOR -->
    <div class="search-box">
      <input id="buscar" type="text" class="form-control form-control-lg"
             placeholder="Buscar materia...">
    </div>

    <!-- LISTA COMPLETA -->
    {% for licenciatura, semestres in materias.items() %}
    <div class="card mb-4 shadow-sm lic-box">

      <div class="card-header bg-primary text-white font-weight-bold">
        {{ licenciatura }}
      </div>

      <div class="card-body">
        <div class="row">

          {% for semestre in range(1, 8) %}
          <div class="col-md-6 col-lg-4 mb-3 semestre-box">

            <div class="border p-3 bg-white rounded shadow-sm">

              <h5 class="text-info font-weight-bold">Semestre {{ semestre }}</h5>

              {% set lista = semestres.get(semestre|string, []) %}
              {% set lista_ordenada = lista|sort(attribute='nombre') %}

              {% if lista_ordenada %}
              <ul class="list-group list-group-flush">

                {% for materia in lista_ordenada %}
                <li class="list-group-item d-flex justify-content-between align-items-center materia-item">
                  
                  <span class="materia-nombre">{{ materia.nombre }}</span>
                  
                  <button class="btn btn-sm btn-danger delete-button"
                          data-id="{{ materia.id }}"
                          data-nombre="{{ materia.nombre }}">
                    Eliminar
                  </button>

                </li>
                {% endfor %}

              </ul>

              {% else %}
              <p class="text-muted no-materias">Sin materias registradas.</p>
              {% endif %}

            </div>
          </div>
          {% endfor %}

        </div>
      </div>
    </div>
    {% endfor %}
  </div>




<script>
/* üóëÔ∏è ELIMINAR CON ANIMACI√ìN */
document.addEventListener("DOMContentLoaded", () => {
    const botones = document.querySelectorAll(".delete-button");

    botones.forEach(boton => {
        boton.addEventListener("click", async function () {
            const id = this.dataset.id;
            const nombre = this.dataset.nombre;

            if (!confirm(`¬øSeguro que deseas eliminar "${nombre}"?`)) return;

            const response = await fetch(`/eliminar_materia/${id}`, {
                method: "POST",
                headers: { "X-Requested-With": "XMLHttpRequest" }
            });

            const result = await response.json();

            if (result.success) {
                const li = this.closest("li");
                li.classList.add("fade-out");
                setTimeout(() => li.remove(), 300);
            } else {
                alert("Error: " + result.error);
            }
        });
    });
});



/* üîç BUSCADOR AVANZADO CON RESALTADO */
document.getElementById("buscar").addEventListener("keyup", function () {
    const filtro = this.value.toLowerCase();

    const materias = document.querySelectorAll(".materia-item");

    materias.forEach(item => {
        const span = item.querySelector(".materia-nombre");
        const texto = span.innerText.toLowerCase();

        // Mostrar u ocultar
        item.style.display = texto.includes(filtro) ? "" : "none";

        // Quitar highlight anterior
        span.innerHTML = span.innerText;

        // Agregar highlight
        if (filtro.length > 0 && texto.includes(filtro)) {
            const regex = new RegExp(`(${filtro})`, "gi");
            span.innerHTML = span.innerText.replace(regex, "<mark>$1</mark>");
        }
    });

    // Ocultar semestres vac√≠os
    document.querySelectorAll(".semestre-box").forEach(box => {
        const visibles = box.querySelectorAll(".materia-item:not([style*='display: none'])");
        const no_materias = box.querySelector(".no-materias");

        if (visibles.length > 0) {
            box.style.display = "";
            if (no_materias) no_materias.style.display = "none";
        } else {
            box.style.display = "none";
        }
    });

    // Ocultar licenciaturas vac√≠as
    document.querySelectorAll(".lic-box").forEach(box => {
        const visibles = box.querySelectorAll(".semestre-box:not([style*='display: none'])");

        box.style.display = visibles.length > 0 ? "" : "none";
    });
});
</script>

</body>
</html>
