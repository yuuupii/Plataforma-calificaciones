<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador Automático de Crucigramas 22×22</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1, h2, h3 { text-align: center; }
    #container { display: flex; gap: 20px; }
    #left, #right { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    #grid { border-collapse: collapse; margin: 0 auto; }
    #grid td { width: 24px; height: 24px; border: 1px solid #ccc; text-align: center; vertical-align: middle; position: relative; }
    #grid td.placed { border: 2px solid #333; background: #eef; }
    #grid td.numbered::before { content: attr(data-num); position: absolute; top: 0; left: 2px; font-size: 0.6em; }
    table#inputTable { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
    table#inputTable th, table#inputTable td { border: 1px solid #ccc; padding: 6px; }
    table#inputTable th { background: #eee; }
    #controls button, #exportPdfBtn { padding: 10px 14px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; }
    #controls button:hover, #exportPdfBtn:hover { background: #0056b3; }
    #clues { display: flex; gap: 20px; margin-top: 20px; }
    .clue-section { flex: 1; max-height: 400px; overflow-y: auto; }
    .clue-card { background: #f0f8ff; margin: 5px; padding: 10px; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .clue-card p { margin: 0; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>Generador Automático de Crucigramas 22×22</h1>
  <div id="container">
    <div id="left">
      <h2>Palabras y Definiciones</h2>
      <div id="controls">
        <table id="inputTable">
          <thead>
            <tr><th>#</th><th>Palabra</th><th>Definición</th></tr>
          </thead>
          <tbody id="inputBody"></tbody>
        </table>
        <button id="addRowBtn">+ Agregar Fila</button>
        <button id="generateBtn">Generar</button>
        <button id="exportPdfBtn">Exportar PDF</button>
      </div>
    </div>
    <div id="right">
      <h2>Crucigrama</h2>
      <table id="grid"></table>
      <div id="clues">
        <div class="clue-section"><h3>Horizontales</h3><div id="hClues"></div></div>
        <div class="clue-section"><h3>Verticales</h3><div id="vClues"></div></div>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script>
    const size = 22;
    let grid = [];
    const gridEl = document.getElementById('grid');
    let clueNum = 1;

    function createGrid() {
      gridEl.innerHTML = '';
      grid = Array.from({length: size}, () => Array(size).fill(null));
      for (let r = 0; r < size; r++) {
        const tr = document.createElement('tr');
        for (let c = 0; c < size; c++) {
          const td = document.createElement('td'); td.textContent = '';
          tr.appendChild(td);
        }
        gridEl.appendChild(tr);
      }
    }

    document.getElementById('addRowBtn').onclick = () => {
      const tbody = document.getElementById('inputBody');
      const num = tbody.children.length + 1;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${num}</td><td><input class="word" maxlength="22"></td><td><input class="def"></td>`;
      tbody.appendChild(tr);
    };

    function canPlace(word, r, c, dir) {
      for (let i = 0; i < word.length; i++) {
        const rr = r + (dir === 'vertical' ? i : 0);
        const cc = c + (dir === 'horizontal' ? i : 0);
        if (rr < 0 || rr >= size || cc < 0 || cc >= size) return false;
        const ch = grid[rr][cc];
        if (ch && ch !== word[i]) return false;
      }
      return true;
    }

    function placeWord(word, def, r, c, dir) {
      for (let i = 0; i < word.length; i++) {
        const rr = r + (dir === 'vertical' ? i : 0);
        const cc = c + (dir === 'horizontal' ? i : 0);
        grid[rr][cc] = word[i];
        const td = gridEl.rows[rr].cells[cc];
        td.textContent = word[i]; td.classList.add('placed');
        if (i === 0) {
          td.classList.add('numbered'); td.setAttribute('data-num', clueNum);
        }
      }
      const div = document.createElement('div');
      div.className = 'clue-card';
      div.innerHTML = `<p><strong>${clueNum}.</strong> ${def}</p>`;
      (dir === 'horizontal' ? document.getElementById('hClues') : document.getElementById('vClues')).appendChild(div);
      clueNum++;
    }

    function findConnectedPosition(word) {
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          const ch = grid[r][c];
          if (!ch) continue;
          for (let i = 0; i < word.length; i++) {
            if (word[i] !== ch) continue;
            const startH = {r: r, c: c - i};
            if (canPlace(word, startH.r, startH.c, 'horizontal')) return {pos: startH, dir: 'horizontal'};
            const startV = {r: r - i, c: c};
            if (canPlace(word, startV.r, startV.c, 'vertical')) return {pos: startV, dir: 'vertical'};
          }
        }
      }
      return null;
    }

    document.getElementById('generateBtn').onclick = () => {
      clueNum = 1;
      document.getElementById('hClues').innerHTML = '';
      document.getElementById('vClues').innerHTML = '';
      createGrid();

      let items = Array.from(document.querySelectorAll('#inputBody tr')).map(tr => {
        return {w: tr.querySelector('.word').value.trim().toUpperCase(), d: tr.querySelector('.def').value.trim()};
      }).filter(x => x.w && x.d);
      if (!items.length) return;

      // ordenar por longitud descendente
      items.sort((a,b) => b.w.length - a.w.length);

      // colocar cada
      items.forEach((item, index) => {
        if (index === 0) {
          const r0 = Math.floor(size/2);
          const c0 = Math.floor((size - item.w.length)/2);
          placeWord(item.w, item.d, r0, c0, 'horizontal');
        } else {
          const conn = findConnectedPosition(item.w);
          if (conn) {
            placeWord(item.w, item.d, conn.pos.r, conn.pos.c, conn.dir);
          } else {
            // intento random
            for (let tries = 0; tries < 200; tries++) {
              const dir = Math.random() < 0.5 ? 'horizontal' : 'vertical';
              const r = Math.floor(Math.random() * size);
              const c = Math.floor(Math.random() * size);
              if (canPlace(item.w, r, c, dir)) {
                placeWord(item.w, item.d, r, c, dir);
                break;
              }
            }
          }
        }
      });
    };

    document.getElementById('exportPdfBtn').onclick = () => {
      const element = document.getElementById('right');
      html2pdf().set({ margin: 10, filename: 'crucigrama.pdf' }).from(element).save();
    };

    createGrid(); document.getElementById('addRowBtn').onclick();
  </script>
</body>
</html>
